<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>RDS on Klog</title><link>https://kseki.github.io/tags/rds/</link><description>Recent content in RDS on Klog</description><generator>Hugo -- gohugo.io</generator><language>ja-jp</language><copyright>kseki</copyright><lastBuildDate>Tue, 30 Jul 2024 16:40:32 +0900</lastBuildDate><atom:link href="https://kseki.github.io/tags/rds/index.xml" rel="self" type="application/rss+xml"/><item><title>AWS RDSスナップショットのマルチアカウント・マルチリージョン移行方法</title><link>https://kseki.github.io/posts/aws-rds-snapshot-migration/</link><pubDate>Tue, 30 Jul 2024 16:40:32 +0900</pubDate><guid>https://kseki.github.io/posts/aws-rds-snapshot-migration/</guid><description>&lt;img src="https://kseki.github.io/posts/aws-rds-snapshot-migration/cover.webp" alt="Featured image of post AWS RDSスナップショットのマルチアカウント・マルチリージョン移行方法" />&lt;p>AWS環境で運用しているアプリケーションは、複数のアカウントや異なるリージョンで構築されることがあります。この記事では、そのような状況でAWS RDSのスナップショットを共有し、復元する方法を詳しく説明します。&lt;/p>
&lt;h2 id="作業概要">作業概要
&lt;/h2>&lt;p>以下のような複数アカウント・複数リージョン運用のケース。&lt;/p>
&lt;ul>
&lt;li>アカウントA: 東京リージョン&lt;/li>
&lt;li>アカウントB: オレゴンリージョン&lt;/li>
&lt;/ul>
&lt;p>アカウントAの東京リージョンの暗号化しているRDSインスタンスのスナップショットを、アカウントBのオレゴンリージョンで復元したい。&lt;/p>
&lt;h2 id="忙しい人の為の手順書">忙しい人の為の手順書
&lt;/h2>&lt;p>&lt;strong>アカウントAにて&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>対象RDSインスタンスのスナップショットをとる&lt;/li>
&lt;li>アカウントBと共有するカスタマー管理キーをマルチリージョンで作成する&lt;/li>
&lt;li>上記のカスタマー管理キーのレプリカをオレゴンリージョンに作成する&lt;/li>
&lt;li>スナップショットを手順2にて作成したカスタマー管理キーでオレゴンリージョンにコピーする&lt;/li>
&lt;li>手順4でコピーしたスナップショットをアカウントBに共有する&lt;/li>
&lt;li>3で作成したレプリカのカスタマー管理キーをアカウントBに共有する&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>アカウントBにて&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>オレゴンリージョンのRDS共有スナップショットを確認する&lt;/li>
&lt;li>手順1の共有スナップショットをコピーする
&lt;ul>
&lt;li>共有スナップショットを復元できませんが、コピーすることで復元可能になります。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>手順2にてコピーしたスナップショットを復元する&lt;/li>
&lt;/ol>
&lt;h2 id="スナップショット移行の手順">スナップショット移行の手順
&lt;/h2>&lt;h3 id="アカウントaで作業">アカウントAで作業
&lt;/h3>&lt;h4 id="スナップショットの作成">スナップショットの作成
&lt;/h4>&lt;p>アカウントAで対象となるRDSインスタンスのスナップショットを作成します。&lt;/p>
&lt;p>&lt;img src="https://kseki.github.io/posts/aws-rds-snapshot-migration/A-1.webp"
width="751"
height="550"
loading="lazy"
alt="スナップショットの作成"
class="gallery-image"
data-flex-grow="136"
data-flex-basis="327px"
>&lt;/p>
&lt;h4 id="kmsカスタマー管理型のキーの作成">KMSカスタマー管理型のキーの作成
&lt;/h4>&lt;p>アカウントAでアカウントBと共有するマルチリージョン対応のKMSキーを東京リージョンで作成します。&lt;/p>
&lt;p>KMS &amp;gt; カスタマー管理型のキー &amp;gt; キーの作成
&lt;img src="https://kseki.github.io/posts/aws-rds-snapshot-migration/A-2.webp"
width="771"
height="850"
loading="lazy"
alt="カスタマー管理型のキー作成"
class="gallery-image"
data-flex-grow="90"
data-flex-basis="217px"
>&lt;/p>
&lt;h4 id="kmsカスタマー管理型のキーのレプリカ作成">KMSカスタマー管理型のキーのレプリカ作成
&lt;/h4>&lt;p>アカウントAにて、東京リージョンで作成したキーのレプリカをオレゴンリージョンで作成します。&lt;/p>
&lt;p>KMS &amp;gt; カスタマー管理型のキー &amp;gt; キー ID: XXXXXXXXXXXXXXX
&lt;img src="https://kseki.github.io/posts/aws-rds-snapshot-migration/A-3-1.webp"
width="796"
height="414"
loading="lazy"
alt="カスタマー管理型のキー詳細"
class="gallery-image"
data-flex-grow="192"
data-flex-basis="461px"
>&lt;/p>
&lt;p>関連するマルチリージョンキー &amp;gt; 新しいレプリカキーを作成&lt;/p>
&lt;p>&lt;img src="https://kseki.github.io/posts/aws-rds-snapshot-migration/A-3-2.webp"
width="745"
height="298"
loading="lazy"
alt="新しいレプリカキーを作成"
class="gallery-image"
data-flex-grow="250"
data-flex-basis="600px"
>&lt;/p>
&lt;p>&lt;strong>オレゴンリージョン&lt;/strong>を選択する。&lt;/p>
&lt;h4 id="スナップショットのコピー">スナップショットのコピー
&lt;/h4>&lt;p>アカウントAで作成したスナップショットを、手順2で作成したKMSキーを使用してオレゴンリージョンにコピーします。&lt;/p>
&lt;p>RDS &amp;gt; スナップショット &amp;gt; スナップショットをコピー&lt;/p>
&lt;p>&lt;img src="https://kseki.github.io/posts/aws-rds-snapshot-migration/A-4.webp"
width="832"
height="828"
loading="lazy"
alt="スナップショットのコピー"
class="gallery-image"
data-flex-grow="100"
data-flex-basis="241px"
>&lt;/p>
&lt;p>AWS KMSキーに上で作成したキーを指定する。&lt;/p>
&lt;h4 id="スナップショットの共有">スナップショットの共有
&lt;/h4>&lt;p>アカウントAでコピーしたスナップショットをアカウントBと共有します。&lt;/p>
&lt;p>&lt;img src="https://kseki.github.io/posts/aws-rds-snapshot-migration/A-5.webp"
width="839"
height="707"
loading="lazy"
alt="スナップショットのアクセス許可"
class="gallery-image"
data-flex-grow="118"
data-flex-basis="284px"
>&lt;/p>
&lt;p>AWSアカウントIDに、&lt;strong>アカウントBのID&lt;/strong>を入力する。&lt;/p>
&lt;h4 id="kmsキーの共有">KMSキーの共有
&lt;/h4>&lt;p>アカウントAで作成したレプリカのカスタマー管理キーをアカウントBに共有する。&lt;/p>
&lt;p>&lt;img src="https://kseki.github.io/posts/aws-rds-snapshot-migration/A-6.webp"
width="634"
height="376"
loading="lazy"
alt="カスタマー管理キーの共有"
class="gallery-image"
data-flex-grow="168"
data-flex-basis="404px"
>&lt;/p>
&lt;p>&lt;strong>アカウントBのID&lt;/strong>を入力する。&lt;/p>
&lt;h3 id="アカウントbで作業">アカウントBで作業
&lt;/h3>&lt;h4 id="オレゴンリージョンのrds共有スナップショットの確認">オレゴンリージョンのRDS共有スナップショットの確認
&lt;/h4>&lt;p>共有スナップショットが参照できるか確認します。&lt;/p>
&lt;p>&lt;img src="https://kseki.github.io/posts/aws-rds-snapshot-migration/B-1.webp"
width="1160"
height="374"
loading="lazy"
alt="共有スナップショット"
class="gallery-image"
data-flex-grow="310"
data-flex-basis="744px"
>&lt;/p>
&lt;h4 id="共有スナップショットのコピー">共有スナップショットのコピー
&lt;/h4>&lt;p>アカウントBで共有されたスナップショットをコピーします。&lt;/p>
&lt;p>&lt;img src="https://kseki.github.io/posts/aws-rds-snapshot-migration/B-2-1.webp"
width="1166"
height="365"
loading="lazy"
alt="共有スナップショット"
class="gallery-image"
data-flex-grow="319"
data-flex-basis="766px"
>&lt;/p>
&lt;p>&lt;img src="https://kseki.github.io/posts/aws-rds-snapshot-migration/B-2-2.webp"
width="766"
height="542"
loading="lazy"
alt="共有スナップショット"
class="gallery-image"
data-flex-grow="141"
data-flex-basis="339px"
>&lt;/p>
&lt;p>Amazonリソースネーム(ARN): 先ほど共有した&lt;strong>レプリカのカスタマー管理キーのARN&lt;/strong>を入力する。&lt;/p>
&lt;h4 id="スナップショットのリストア">スナップショットのリストア
&lt;/h4>&lt;p>アカウントBでコピーしたスナップショットをリストアします。&lt;/p>
&lt;p>この手順により、AWS RDSのスナップショットを異なるアカウントとリージョン間で移行することが可能となります。&lt;/p>
&lt;div class="amazon-widget">
&lt;div class="amazon-widget-img">
&lt;a href="https://www.amazon.co.jp/gp/product/4297104083/tag=kseki0c-22" target="_blank">
&lt;img src="https://m.media-amazon.com/images/I/81z7uX1cs5L._AC_SX522_.jpg" />
&lt;/a>
&lt;/div>
&lt;div class="amazon-widget-info">
&lt;a href="https://www.amazon.co.jp/gp/product/4297104083/tag=kseki0c-22" target="_blank">
&lt;span class="amazon-widget-title">
失敗から学ぶRDBの正しい歩き方 (Software Design plus)
&lt;/span>
&lt;/a>
&lt;a href="https://www.amazon.co.jp/gp/product/4297104083/tag=kseki0c-22" class="amazon-widget-button" target="_blank">Amazonで購入&lt;/a>
&lt;/div>
&lt;/div></description></item></channel></rss>